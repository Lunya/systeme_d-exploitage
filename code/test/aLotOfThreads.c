#include "syscall.h"
#define THIS "a"
/*
 * Ce programme, qui permet de tester la gestion des threads,
 * et donc, la création ainsi que la destruction de multiples threads.
 * Il permet de tester nottament le bon déroulement du programme
 * si les threads terminent après le thread principal ainsi
 * que l'éxécution d'un très grand nombre de threads.
 * Une fonction "utilisateur" a été crée pour éviter de repréciser
 * ThreadExit dans chaque ThreadCreate (pour éviter de mettre ThreadExit
 * dans chaque fonction).
 */

const int N = 2;

void puts(const char *s)
{
	const char * p; 
	for (p = s; *p != '\0'; p++)
		PutChar(*p);
}

void f(void *arg)
{
	const char *s = arg;
	int i;
	for (i = 0; i < N; i++)
		puts(s);
}

void user_ThreadCreate(void f(void *arg), void *arg) {
	ThreadCreate(f, arg, ThreadExit);
}

int
main()
{
	int i;
	for (i=0;i<12;i++)
	{
		user_ThreadCreate(f, THIS);
	}
}
